<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>TeReto â€” Login</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Ubuntu, "Helvetica Neue", Arial;
    }
  </style>
</head>

<body class="bg-slate-100 min-h-screen flex items-center justify-center p-6">

  <!-- Pantalla de Login -->
  <div id="login-screen" class="w-full max-w-sm bg-white rounded-2xl shadow-xl p-6">
    <div class="text-center mb-6">
      <h1 class="text-3xl font-bold text-slate-800">TeReto</h1>
      <p class="text-slate-500 mt-1">AccedÃ© con tu cuenta de Google</p>
    </div>
    <button id="login-button"
      class="w-full bg-white border border-slate-300 hover:bg-slate-50 text-slate-800 rounded-xl py-3 font-semibold flex items-center justify-center gap-3">
      <img src="https://www.svgrepo.com/show/355037/google.svg" alt="Google" class="w-5 h-5" />
      Continuar con Google
    </button>
    <p id="login-error" class="hidden mt-3 text-sm text-red-600"></p>
  </div>

  <!-- Pantalla de App -->
  <div id="app-screen" class="hidden w-full max-w-lg bg-white rounded-2xl shadow-xl p-6">
    <div class="flex items-center justify-between">
      <div class="flex items-center gap-3">
        <img id="profile-pic" class="w-10 h-10 rounded-full border" src="" alt="Foto de perfil" />
        <div>
          <p id="user-name" class="font-semibold text-slate-800">â€”</p>
          <p id="user-email" class="text-sm text-slate-500">â€”</p>
        </div>
      </div>
      <button id="logout-button" class="text-sm bg-slate-100 hover:bg-slate-200 px-3 py-1.5 rounded-lg">
        Cerrar sesiÃ³n
      </button>
    </div>
    <div class="mt-6 text-slate-600">
      <p>SesiÃ³n iniciada correctamente. Bienvenido a <b>TeReto</b>.</p>
    </div>
  </div>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
    import {
      getAuth,
      GoogleAuthProvider,
      signInWithPopup,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";

    // ðŸ”¥ ConfiguraciÃ³n Firebase (tereto-prod)
    const firebaseConfig = {
      apiKey: "AIzaSyCSdjAdY7ymmOwIN7zApP-XpXxTar_0pHk",
      authDomain: "tereto-prod.firebaseapp.com",
      projectId: "tereto-prod",
      storageBucket: "tereto-prod.appspot.com",
      messagingSenderId: "914605096619",
      appId: "1:914605096619:web:88a9b78eac50c35cb181ee"
    };

    // Inicializar Firebase
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const provider = new GoogleAuthProvider();

    // Referencias UI
    const loginBtn = document.getElementById("login-button");
    const logoutBtn = document.getElementById("logout-button");
    const loginScreen = document.getElementById("login-screen");
    const appScreen = document.getElementById("app-screen");
    const errEl = document.getElementById("login-error");
    const nameEl = document.getElementById("user-name");
    const emailEl = document.getElementById("user-email");
    const photoEl = document.getElementById("profile-pic");

    // Funciones auxiliares
    function showError(msg) {
      errEl.textContent = msg;
      errEl.classList.remove("hidden");
    }
    function clearError() {
      errEl.classList.add("hidden");
      errEl.textContent = "";
    }

    // Login con Google
    loginBtn.addEventListener("click", async () => {
      clearError();
      try {
        await signInWithPopup(auth, provider);
      } catch (error) {
        console.error("Error de login:", error.code, error.message);
        showError("Error: " + error.code);
      }
    });

    // Logout
    logoutBtn.addEventListener("click", () => signOut(auth));

    // Escucha de sesiÃ³n
    onAuthStateChanged(auth, (user) => {
      if (user) {
        // Mostrar datos
        nameEl.textContent = user.displayName || "Usuario";
        emailEl.textContent = user.email || "";
        photoEl.src = user.photoURL || "https://placehold.co/80x80";
        loginScreen.classList.add("hidden");
        appScreen.classList.remove("hidden");
      } else {
        appScreen.classList.add("hidden");
        loginScreen.classList.remove("hidden");
      }
    });
  </script>

</body>
</html>
